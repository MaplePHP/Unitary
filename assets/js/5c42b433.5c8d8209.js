"use strict";(globalThis.webpackChunkunitary=globalThis.webpackChunkunitary||[]).push([[7397],{5205:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>h,contentTitle:()=>c,default:()=>o,frontMatter:()=>d,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"mocker/creating-mocks","title":"Creating mocks","description":"Unitary\'s mocking engine is designed to make mocking in PHP simpler, more expressive, and better integrated into your test flow. Unitary removes unnecessary boilerplate and lets you focus on the behavior you want to verify.","source":"@site/docs/mocker/2-creating-mocks.mdx","sourceDirName":"mocker","slug":"/mocker/creating-mocks","permalink":"/Unitary/docs/mocker/creating-mocks","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Creating mocks"},"sidebar":"tutorialSidebar","previous":{"title":"Introduction to Mocker","permalink":"/Unitary/docs/mocker/introduction-to-mocker"},"next":{"title":"Method Expectations & Behaviors","permalink":"/Unitary/docs/mocker/method-expectations"}}');var i=t(4848),n=t(8453);const d={title:"Creating mocks"},c="Creating mocks",h={},l=[{value:"Basic Example",id:"basic-example",level:2},{value:"Validate Method Behaviors",id:"validate-method-behaviors",level:2},{value:"Sample Error Output",id:"sample-error-output",level:4},{value:"Features Overview",id:"features-overview",level:2},{value:"Should You Use It for Code Quality Checks?",id:"should-you-use-it-for-code-quality-checks",level:2}];function a(e){const s={code:"code",em:"em",h1:"h1",h2:"h2",h4:"h4",header:"header",hr:"hr",img:"img",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,n.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"creating-mocks",children:"Creating mocks"})}),"\n",(0,i.jsx)(s.p,{children:"Unitary's mocking engine is designed to make mocking in PHP simpler, more expressive, and better integrated into your test flow. Unitary removes unnecessary boilerplate and lets you focus on the behavior you want to verify."}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"basic-example",children:"Basic Example"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-php",children:'group("Mocking a PSR-7 Stream", function(TestCase $case) {\n    // Create a mock of a PSR-7 StreamInterface\n    $stream = $case->mock(StreamInterface::class);\n\n    // Inject the mock into a Response object\n    $response = new Response($stream);\n    \n    $case->expect($response->getBody())\n         ->isInstanceOf(StreamInterface::class)\n         ->validate();\n});\n'})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.em,{children:"This is actually all you need to do to mock a class."})}),"\n",(0,i.jsx)(s.h2,{id:"validate-method-behaviors",children:"Validate Method Behaviors"}),"\n",(0,i.jsxs)(s.p,{children:["You can configure and validate some method behaviors in Unitary mocker. This is done via a ",(0,i.jsx)(s.code,{children:"MethodRegistry"})," callback passed as the second argument to ",(0,i.jsx)(s.code,{children:"mock()"}),"."]}),"\n",(0,i.jsx)(s.p,{children:"This is similar to exposing the mocked class, giving you full control to define expectations and behaviors for specific methods within it."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-php",children:'group("Testing a User Registration Service", function(TestCase $case) {\n\n    $mailer = $case->mock(Mailer::class, function(MethodRegistry $method) {\n\n        // Specify "all" the methods from the Mailer class here that you want to\n        // configure with custom expectations and return behaviors.\n        $method->method("sendWelcomeEmail")\n            ->called(1)\n            ->willReturn(true);\n\n        $method->method("getFromAddress")\n            ->willReturn("user@example.com");\n    });\n\n    $service = new UserService($mailer);\n\n    $case->expect($service->register("user@example.com"))\n         ->isTrue()\n         ->validate();\n});\n'})}),"\n",(0,i.jsx)(s.h4,{id:"sample-error-output",children:"Sample Error Output"}),"\n",(0,i.jsx)(s.p,{children:"When a mock expectation fails, Unitary shows a detailed, test-aware error message:"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"https://wazabii.se/github-assets/unitary/unitary-cli-mock-fail.png",alt:"Unitary CLI response"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"features-overview",children:"Features Overview"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Feature"}),(0,i.jsx)(s.th,{children:"Description"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"called(timeCount)"})}),(0,i.jsxs)(s.td,{children:["Ensures the method is called exactly ",(0,i.jsx)(s.code,{children:"timeCount"})," times"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"hasBeenCalled()"})}),(0,i.jsx)(s.td,{children:"Verifies that the method has been called at least once"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"calledAtLeast(timeCount)"})}),(0,i.jsxs)(s.td,{children:["Ensures the method is called ",(0,i.jsx)(s.code,{children:"timeCount"})," times or more"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"calledAtMost(timeCount)"})}),(0,i.jsxs)(s.td,{children:["Ensures the method is called ",(0,i.jsx)(s.code,{children:"timeCount"})," times or fewer"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"withArguments(...args)"})}),(0,i.jsx)(s.td,{children:"Validates arguments passed to the method in its first call"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"withArgumentsForCalls(...)"})}),(0,i.jsx)(s.td,{children:"Validates arguments for multiple calls with distinct expected parameters"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"withArgumentAt(pos, val)"})}),(0,i.jsx)(s.td,{children:"Validates a specific argument position for a given call index"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"willReturn(val)"})}),(0,i.jsx)(s.td,{children:"Defines return value(s) for the method"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"hasReturn()"})}),(0,i.jsx)(s.td,{children:"Checks if a return value has been set"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"willThrow(throwable)"})}),(0,i.jsx)(s.td,{children:"Configures the method to throw an exception every time it's called"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"willThrowOnce(throwable)"})}),(0,i.jsx)(s.td,{children:"Configures the method to throw an exception only once"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"keepOriginal()"})}),(0,i.jsx)(s.td,{children:"Executes the original method instead of mocking it"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"wrap()"})}),(0,i.jsx)(s.td,{children:"Decorates the method while executing on the real class instance"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"hasClass(name)"})}),(0,i.jsx)(s.td,{children:"Ensures that the method belongs to the specified class"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"hasName(name)"})}),(0,i.jsx)(s.td,{children:"Ensures that the method has the specified name"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"isStatic()"})}),(0,i.jsx)(s.td,{children:"Ensures the method is static"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"isPublic()"})}),(0,i.jsx)(s.td,{children:"Ensures the method has public visibility"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"isPrivate()"})}),(0,i.jsx)(s.td,{children:"Ensures the method has private visibility"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"isProtected()"})}),(0,i.jsx)(s.td,{children:"Ensures the method has protected visibility"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"isAbstract()"})}),(0,i.jsx)(s.td,{children:"Ensures the method is abstract"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"isFinal()"})}),(0,i.jsx)(s.td,{children:"Ensures the method is final"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"returnsReference()"})}),(0,i.jsx)(s.td,{children:"Checks if the method returns by reference"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"hasReturnType()"})}),(0,i.jsx)(s.td,{children:"Checks if the method declares a return type"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"isReturnType(type)"})}),(0,i.jsx)(s.td,{children:"Validates that the return type matches the expected type"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"isConstructor()"})}),(0,i.jsxs)(s.td,{children:["Checks if the method is a constructor (",(0,i.jsx)(s.code,{children:"__construct"}),")"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"isDestructor()"})}),(0,i.jsxs)(s.td,{children:["Checks if the method is a destructor (",(0,i.jsx)(s.code,{children:"__destruct"}),")"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"hasParams()"})}),(0,i.jsx)(s.td,{children:"Ensures the method has at least one parameter"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"hasNotParams()"})}),(0,i.jsx)(s.td,{children:"Ensures the method has no parameters"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"hasParamsTypes()"})}),(0,i.jsx)(s.td,{children:"Checks that all parameters have type declarations"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"paramsHasCount(length)"})}),(0,i.jsxs)(s.td,{children:["Ensures the method has exactly ",(0,i.jsx)(s.code,{children:"length"})," parameters"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"paramIsType(index, type)"})}),(0,i.jsxs)(s.td,{children:["Ensures the parameter at index ",(0,i.jsx)(s.code,{children:"index"})," has the specified data type"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"paramHasType(index)"})}),(0,i.jsxs)(s.td,{children:["Checks if parameter at index ",(0,i.jsx)(s.code,{children:"index"})," has a type declared"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"paramHasDefault(index, val)"})}),(0,i.jsxs)(s.td,{children:["Checks if parameter at index ",(0,i.jsx)(s.code,{children:"index"})," has the given default value"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"paramIsOptional(index)"})}),(0,i.jsxs)(s.td,{children:["Checks if parameter at index ",(0,i.jsx)(s.code,{children:"index"})," is optional"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"paramIsReference(index)"})}),(0,i.jsxs)(s.td,{children:["Checks if parameter at index ",(0,i.jsx)(s.code,{children:"index"})," is passed by reference"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"paramIsVariadic(index)"})}),(0,i.jsxs)(s.td,{children:["Checks if parameter at index ",(0,i.jsx)(s.code,{children:"index"})," is variadic (spread)"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"paramIsSpread(index)"})}),(0,i.jsxs)(s.td,{children:["Alias of ",(0,i.jsx)(s.code,{children:"paramIsVariadic(index)"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"hasDocComment()"})}),(0,i.jsx)(s.td,{children:"Validates that the method has a docblock"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"hasFileName(name)"})}),(0,i.jsx)(s.td,{children:"Ensures the method is defined in the given file name"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"startLine(n)"})}),(0,i.jsx)(s.td,{children:"Checks if the method starts on the specified line number"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"endLine(n)"})}),(0,i.jsx)(s.td,{children:"Checks if the method ends on the specified line number"})]})]})]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"should-you-use-it-for-code-quality-checks",children:"Should You Use It for Code Quality Checks?"}),"\n",(0,i.jsxs)(s.p,{children:["Unitary's mocking API includes optional checks like ",(0,i.jsx)(s.code,{children:"hasDocComment()"})," and ",(0,i.jsx)(s.code,{children:"isPublic()"}),", which can help identify inconsistencies or incomplete interfaces. While helpful during development, these are not replacements for dedicated static analysis tools like PHPStan or Psalm. Think of them as guardrails \u2014 not primary validation sources."]})]})}function o(e={}){const{wrapper:s}={...(0,n.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453:(e,s,t)=>{t.d(s,{R:()=>d,x:()=>c});var r=t(6540);const i={},n=r.createContext(i);function d(e){const s=r.useContext(n);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(n.Provider,{value:s},e.children)}}}]);