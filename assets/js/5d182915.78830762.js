"use strict";(globalThis.webpackChunkunitary=globalThis.webpackChunkunitary||[]).push([[3042],{2206:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"mocker/method-expectations","title":"Method Expectations & Behaviors","description":"Even though Unitary allows you to mock classes in a single line, there are times when you may want more control.","source":"@site/docs/mocker/3-method-expectations.md","sourceDirName":"mocker","slug":"/mocker/method-expectations","permalink":"/Unitary/docs/mocker/method-expectations","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Method Expectations & Behaviors"},"sidebar":"tutorialSidebar","previous":{"title":"Creating mocks","permalink":"/Unitary/docs/mocker/creating-mocks"},"next":{"title":"Mocking Final & Private Methods","permalink":"/Unitary/docs/mocker/mocking-final-private-methods"}}');var i=t(4848),o=t(8453);const l={title:"Method Expectations & Behaviors"},r="Method Expectations & Behaviors",c={},a=[{value:"Return Values",id:"return-values",level:2},{value:"Return Values by Call Order",id:"return-values-by-call-order",level:2},{value:"Keeping original behavior",id:"keeping-original-behavior",level:2},{value:"Wrapping behavior",id:"wrapping-behavior",level:2},{value:"Throwing Exceptions",id:"throwing-exceptions",level:2},{value:"Mixing <code>throw</code> and <code>return</code>",id:"mixing-throw-and-return",level:2},{value:"Argument Expectations",id:"argument-expectations",level:2},{value:"Arguments per Call",id:"arguments-per-call",level:2},{value:"Call Count Expectations",id:"call-count-expectations",level:2},{value:"Available call count methods:",id:"available-call-count-methods",level:3},{value:"Additional Notes",id:"additional-notes",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"method-expectations--behaviors",children:"Method Expectations & Behaviors"})}),"\n",(0,i.jsx)(n.p,{children:"Even though Unitary allows you to mock classes in a single line, there are times when you may want more control."}),"\n",(0,i.jsxs)(n.p,{children:["When mocking methods in Unitary, you can optionally define how they should behave and how they are expected to be used.  This guide explains how to configure method behaviors and expectations using the ",(0,i.jsx)(n.code,{children:"mock()"})," and ",(0,i.jsx)(n.code,{children:"method()"})," APIs when needed."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"return-values",children:"Return Values"}),"\n",(0,i.jsx)(n.p,{children:"To specify a static return value:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$someClass = $case->mock(SomeClass::class, function (MethodRegistry $method) {\n    $method->method('getCount')->willReturn(42);\n});\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Whenever ",(0,i.jsx)(n.code,{children:"getCount()"})," is called on the mock, it returns ",(0,i.jsx)(n.code,{children:"42"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"return-values-by-call-order",children:"Return Values by Call Order"}),"\n",(0,i.jsx)(n.p,{children:"You can define a sequence of return values for successive calls:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$someClass = $case->mock(SomeClass::class, function (MethodRegistry $method) {\n    $method->method('getId')->willReturn(1001, 1002, 1003);\n});\n"})}),"\n",(0,i.jsxs)(n.p,{children:["On the first call, it returns ",(0,i.jsx)(n.code,{children:"1001"}),"; on the second, ",(0,i.jsx)(n.code,{children:"1002"}),"; on the third, ",(0,i.jsx)(n.code,{children:"1003"}),", and so on."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"keeping-original-behavior",children:"Keeping original behavior"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"keepOriginal()"})," when a mocked method should run ",(0,i.jsx)(n.strong,{children:"unchanged"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$method->method('getFromEmail')->keepOriginal();\n"})}),"\n",(0,i.jsx)(n.p,{children:"The method executes exactly as it does on the real class. No interception, no modification, no simulation."}),"\n",(0,i.jsx)(n.p,{children:"This is useful when a mock only needs control over specific methods and the remaining behavior should stay real. It allows a mocked instance to participate in an integration-oriented test without replacing logic that is not relevant to the validation."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"keepOriginal()"})," makes the intent explicit: the method exists on the mock, but its behavior is untouched."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"wrapping-behavior",children:"Wrapping behavior"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"wrap()"})," when a method should run ",(0,i.jsx)(n.strong,{children:"custom test logic while still operating on the real class instance"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$method->method('sendEmail')->wrap(function (string $email) {\n    if (!$this->isValidEmail($email)) {\n        return 'FAILED';\n    }\n\n    return \"email:{$email}\";\n});\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The wrapped method executes with ",(0,i.jsx)(n.code,{children:"$this"})," bound to the original class instance. This allows the wrapper to call real helper methods, rely on internal state, and reuse existing validation logic."]}),"\n",(0,i.jsx)(n.p,{children:"Wrapping neither replaces the method nor leaves it untouched. It modifies execution at a specific point while keeping the surrounding behavior real."}),"\n",(0,i.jsx)(n.p,{children:"Use wrapping when you need control without losing access to the original implementation."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"throwing-exceptions",children:"Throwing Exceptions"}),"\n",(0,i.jsx)(n.p,{children:"To simulate errors, you can configure a method to throw:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$someClass = $case->mock(SomeClass::class, function (MethodRegistry $method) {\n    $method->method('connect')->willThrow(new \\RuntimeException('Connection failed'));\n});\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Whenever ",(0,i.jsx)(n.code,{children:"connect()"})," is called, a ",(0,i.jsx)(n.code,{children:"RuntimeException"})," is thrown."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"mixing-throw-and-return",children:["Mixing ",(0,i.jsx)(n.code,{children:"throw"})," and ",(0,i.jsx)(n.code,{children:"return"})]}),"\n",(0,i.jsxs)(n.p,{children:["You can combine ",(0,i.jsx)(n.code,{children:"willThrowOnce()"})," and ",(0,i.jsx)(n.code,{children:"willReturn()"})," to define behavior over time:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$someClass = $case->mock(SomeClass::class, function (MethodRegistry $method) {\n    $method->method('fetch')\n        ->willThrowOnce(new \\Exception('Failed'))\n        ->willReturn('Success');\n});\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The first call to ",(0,i.jsx)(n.code,{children:"fetch()"})," throws an exception; the second returns ",(0,i.jsx)(n.code,{children:"'Success'"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"argument-expectations",children:"Argument Expectations"}),"\n",(0,i.jsx)(n.p,{children:"You can ensure the method receives exact arguments when called:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$someClass = $case->mock(SomeClass::class, function (MethodRegistry $method) {\n    $method->method('addFromEmail')\n        ->withArguments('john.doe@gmail.com', 'John Doe');\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:"This verifies that the method is called with the given values in the correct order."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"arguments-per-call",children:"Arguments per Call"}),"\n",(0,i.jsx)(n.p,{children:"If you expect different arguments on each call:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$someClass = $case->mock(SomeClass::class, function (MethodRegistry $method) {\n    $method->method('addFromEmail')\n        ->withArgumentsForCalls(\n            ['john.doe@gmail.com', 'John Doe'],\n            ['jane.doe@gmail.com', 'Jane Doe']\n        );\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:"The first call must match the first argument set, the second call the second set, and so on."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"call-count-expectations",children:"Call Count Expectations"}),"\n",(0,i.jsx)(n.p,{children:"You can also enforce how many times a method must be called:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"$someClass = $case->mock(SomeClass::class, function (MethodRegistry $method) {\n    $method->method('save')->called(1);\n});\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This ensures ",(0,i.jsx)(n.code,{children:"save()"})," is called exactly once. If not, the test fails."]}),"\n",(0,i.jsx)(n.h3,{id:"available-call-count-methods",children:"Available call count methods:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Method"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"called(1)"})}),(0,i.jsx)(n.td,{children:"Must be called exactly once"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"called(0)"})}),(0,i.jsx)(n.td,{children:"Must never be called"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"atLeast(2)"})}),(0,i.jsx)(n.td,{children:"Must be called two or more times"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"atMost(3)"})}),(0,i.jsx)(n.td,{children:"Must not be called more than three times"})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"additional-notes",children:"Additional Notes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"willReturn(...)"})," sets fixed outputs."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"wrap(...)"})," gives you dynamic behavior and full class context."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"willThrow(...)"})," and ",(0,i.jsx)(n.code,{children:"willThrowOnce(...)"})," simulate failure scenarios."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"withArguments(...)"})," and ",(0,i.jsx)(n.code,{children:"called(...)"})," help you assert correct usage."]}),"\n",(0,i.jsx)(n.li,{children:"You can combine all of them for powerful test behavior simulation."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>r});var s=t(6540);const i={},o=s.createContext(i);function l(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);